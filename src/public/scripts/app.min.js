!function(){"use strict";const t=()=>{const t=$(".alerts__list");return{create:(e,a)=>{const s=$('<div class="alert alert-dismissible"></div>');s.attr("role","alert"),s.addClass(`alert-${e}`),s.prepend('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'),s.prepend(a),t.append(s)}}},e=()=>{const e="http://localhost:88/api/v1",a=e=>{const{create:a}=t();if(e.status&&400===e.status){a("danger",Object.values(e.responseJSON.messages).join("</br>"))}};return{post:(t,s)=>$.ajax({url:e+t,method:"POST",data:s,error:a}),get:t=>$.ajax({url:e+t,method:"GET",error:a}),remove:t=>$.ajax({url:e+t,method:"DELETE",error:a})}},a=()=>{const{get:t}=e(),a=(t,e)=>{const a=$("#data-table").find("tbody"),s=$("#nav-table");a.html(""),t.forEach((t=>{const n=$("<tr></tr>");n.append(`<td>${t.id}</td>`),n.append(`<td>${t.name}</td>`),n.append(`<td>${t.text}</td>`),n.append(`<td>${t.date}</td>`),n.append(`<td><button data-delete="${t.id}" class="btn btn-danger btn-sm">Удалить</button></td>`),a.append(n),s.html(e)}))};return{load:()=>{const e=new URL(location.href);t("/comments"+e.search).done((t=>{a(t.comments,t.nav)}))}}};$(document).ready((function(){$("#send_comment").submit((function(s){s.preventDefault();const{formInit:n,formSubmit:r}=(()=>{let s,n,r;const o=()=>{const{post:r}=e(),{create:o}=t(),{load:d}=a();n.attr("disabled",!0),r("/comments",s.serialize()).done((()=>{o("success","Комментарий добавлен"),d(),s.trigger("reset")})).always((()=>{n.attr("disabled",!1)}))};return{formInit:t=>{s=t,n=t.find("#send-button"),r=$('[name="name"]'),r.on("input",(function(){const{hideError:t}={emailValidate:t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),showError:t=>{t.addClass("is-invalid"),t.next("small").text("Неверный формат email")},hideError:t=>{t.removeClass("is-invalid"),t.next("small").text("")}};t(r)}))},formSubmit:()=>{const{emailValidate:t,showError:e}={emailValidate:t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),showError:t=>{t.addClass("is-invalid"),t.next("small").text("Неверный формат email")},hideError:t=>{t.removeClass("is-invalid"),t.next("small").text("")}};t(r.val())?o():e(r)}}})();n($(this)),r()}));const{destroyInit:s}=(()=>{const s=s=>{const{remove:n}=e(),{load:r}=a(),{create:o}=t();n("/comments/"+s).done((()=>{o("success","Элемент удален"),r()}))};return{destroyInit:()=>{$("#data-table").on("click","[data-delete]",(t=>{confirm("Подтвердите удаление элемента");const e=$(t.target).data("delete");s(e)}))}}})();s()}))}();
